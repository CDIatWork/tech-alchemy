<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>170 Tests to Guard a 10,000-Line HTML Book &ndash; An AI Journey</title>
  <meta name="description" content="How Playwright tests catch structural and styling regressions in the [CDI@Work]:AI book files.">
  <style>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    html { scroll-behavior: smooth; font-size: 18px; }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
      line-height: 1.8;
      color: #1a1a2e;
      background: linear-gradient(135deg, #f5f7fa 0%, #e4e9f0 100%);
      min-height: 100vh;
    }

    .header {
      background: linear-gradient(135deg, #16213e, #0f3460);
      color: #fff;
      padding: 4rem 2rem 3rem;
      text-align: center;
    }

    .header .tag {
      display: inline-block;
      background: rgba(255,255,255,0.15);
      backdrop-filter: blur(4px);
      padding: 0.3rem 1rem;
      border-radius: 20px;
      font-size: 0.75rem;
      text-transform: uppercase;
      letter-spacing: 0.12em;
      margin-bottom: 1.2rem;
    }

    .header h1 {
      font-size: 2.2rem;
      font-weight: 700;
      line-height: 1.25;
      max-width: 700px;
      margin: 0 auto 1rem;
    }

    .header .meta {
      font-size: 0.85rem;
      opacity: 0.7;
    }

    article {
      max-width: 680px;
      margin: -2rem auto 4rem;
      background: #fff;
      border-radius: 12px;
      box-shadow: 0 4px 24px rgba(0,0,0,0.08);
      padding: 2.5rem 2.5rem 3rem;
    }

    article p {
      margin-bottom: 1.4rem;
    }

    article h2 {
      font-size: 1.3rem;
      color: #0f3460;
      margin: 2.2rem 0 0.8rem;
      padding-bottom: 0.3rem;
      border-bottom: 2px solid #e8ecf1;
    }

    article a {
      color: #0f3460;
      text-decoration: underline;
      text-decoration-color: #b8c6db;
      text-underline-offset: 3px;
      transition: text-decoration-color 0.2s;
    }

    article a:hover {
      text-decoration-color: #0f3460;
    }

    .highlight {
      background: linear-gradient(135deg, #f0f4ff, #e8f0fe);
      border-left: 4px solid #0f3460;
      border-radius: 0 8px 8px 0;
      padding: 1.2rem 1.5rem;
      margin: 1.8rem 0;
      font-size: 0.95rem;
    }

    .highlight strong {
      color: #0f3460;
    }

    code {
      font-family: 'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, monospace;
      font-size: 0.85em;
      background: #f0f2f5;
      padding: 0.15em 0.4em;
      border-radius: 4px;
    }

    pre {
      background: #1e1e2e;
      color: #cdd6f4;
      padding: 1.1rem 1.25rem;
      border-radius: 8px;
      overflow-x: auto;
      font-size: 0.78rem;
      line-height: 1.6;
      border: 1px solid #313244;
      margin: 1.2rem 0;
    }

    pre code {
      background: none;
      padding: 0;
      color: inherit;
      font-size: inherit;
    }

    .test-group {
      background: #f8f9fc;
      border-radius: 8px;
      padding: 1rem 1.2rem;
      margin-bottom: 0.8rem;
      font-size: 0.9rem;
    }

    .test-group strong {
      color: #0f3460;
    }

    .test-group .count {
      float: right;
      background: #0f3460;
      color: #fff;
      font-size: 0.75rem;
      padding: 0.1rem 0.6rem;
      border-radius: 10px;
      font-weight: 600;
    }

    .bug-story {
      background: #fff8f0;
      border-left: 4px solid #e67e22;
      border-radius: 0 8px 8px 0;
      padding: 1.2rem 1.5rem;
      margin: 1.8rem 0;
      font-size: 0.95rem;
    }

    .bug-story strong {
      color: #e67e22;
    }

    .book-links {
      display: flex;
      gap: 1rem;
      margin: 2rem 0;
      flex-wrap: wrap;
    }

    .book-links a {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      background: #0f3460;
      color: #fff;
      text-decoration: none;
      padding: 0.7rem 1.4rem;
      border-radius: 8px;
      font-size: 0.9rem;
      font-weight: 600;
      transition: background 0.2s, transform 0.15s;
    }

    .book-links a:hover {
      background: #16213e;
      transform: translateY(-1px);
    }

    .book-links a .arrow { font-size: 1.1rem; }

    .post-nav {
      max-width: 680px;
      margin: -0.5rem auto 2rem;
      display: flex;
      justify-content: space-between;
      gap: 1rem;
      font-size: 0.85rem;
    }

    .post-nav a {
      color: #0f3460;
      text-decoration: none;
      padding: 0.5rem 0;
      transition: color 0.2s;
    }

    .post-nav a:hover {
      text-decoration: underline;
      text-decoration-color: #b8c6db;
      text-underline-offset: 3px;
    }

    .post-nav .prev { text-align: left; }
    .post-nav .next { text-align: right; margin-left: auto; }

    footer {
      text-align: center;
      padding: 2rem;
      font-size: 0.8rem;
      color: #888;
    }

    footer a {
      color: #888;
      text-decoration: underline;
      text-decoration-color: #ccc;
      text-underline-offset: 2px;
    }

    footer a:hover {
      color: #555;
    }

    @media (max-width: 720px) {
      .header { padding: 3rem 1.5rem 2rem; }
      .header h1 { font-size: 1.6rem; }
      article { margin: -1.5rem 1rem 3rem; padding: 1.5rem; }
      .book-links { flex-direction: column; }
    }
  </style>
</head>
<body>

  <header class="header">
    <div class="tag">AI Journey &middot; Blog Post #4</div>
    <h1>170 Tests to Guard a 10,000-Line HTML Book</h1>
    <p class="meta">February 2026</p>
  </header>

  <article>
    <p>
      When your entire book is a single HTML file &mdash; 10,000+ lines, 9 chapters,
      292 code listings, 74 tip boxes &mdash; a single stray closing tag can silently
      wreck everything downstream. We learned this the hard way.
    </p>

    <h2>The Bug That Started It All</h2>

    <div class="bug-story">
      <strong>What happened:</strong> While adding Chapter 9 to the English edition,
      a stray <code>&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</code> fragment ended up
      in the wrong place. It prematurely closed a <code>latex-begin-block</code> container,
      which broke the DOM nesting from that point forward. Every chapter after chapter 3
      lost its styling &mdash; code blocks turned white, headings lost their borders,
      tip boxes went unstyled. The content was still there, technically. It just looked
      broken.
    </div>

    <p>
      The worst part? Nothing was visually wrong at the top of the page. You had to
      scroll past the first few chapters before the damage became visible.
      The HTML itself had no validation errors &mdash; the browser just silently
      repaired the nesting in a way that moved content outside its intended containers.
    </p>

    <h2>The Test Suite</h2>

    <p>
      Rather than hoping this never happens again, we built a Playwright test suite
      that catches exactly this class of problem. It runs headless Chromium against
      both book files (<code>book.html</code> and <code>book_en.html</code>) and
      verifies 170 assertions across 7 test groups:
    </p>

    <div class="test-group">
      <span class="count">16</span>
      <strong>Global Structure</strong> &mdash; Correct <code>lang</code> attribute,
      exactly 9 chapter sections with sequential IDs, exact counts for h1, h2, code blocks, and tip boxes.
    </div>

    <div class="test-group">
      <span class="count">72</span>
      <strong>Per-Chapter Structure</strong> &mdash; Each chapter has exactly 1 h1,
      the correct number of h2s, all code blocks inside their containers, all tips as
      direct children of their chapter section.
    </div>

    <div class="test-group">
      <span class="count">8</span>
      <strong>DOM Nesting Integrity</strong> &mdash; The bug-catcher. No content outside
      chapter sections. No orphaned <code>&lt;pre&gt;</code> tags outside
      <code>latex-begin-block</code>. No raw Java code (like <code>import jakarta.*</code>
      or <code>public class</code>) appearing as plain text instead of inside code elements.
    </div>

    <div class="test-group">
      <span class="count">62</span>
      <strong>Styling Verification</strong> &mdash; Checks computed CSS values: h1 color
      and border, h2 border, code block dark background, tip box blue accent.
      Plus per-chapter &ldquo;canary&rdquo; tests that verify the <em>last</em> h2, last code block,
      and last tip in each chapter retain their styles &mdash; these are the first elements to break
      when DOM nesting goes wrong.
    </div>

    <div class="test-group">
      <span class="count">6</span>
      <strong>TOC Integrity</strong> &mdash; 9 chapter entries exist, every sidebar link
      resolves to a matching anchor in the content, link text matches heading text.
    </div>

    <div class="test-group">
      <span class="count">4</span>
      <strong>Code Block Containment</strong> &mdash; Every <code>latex-begin-block</code>
      has meaningful content. Code elements actually render in a monospace font.
    </div>

    <div class="test-group">
      <span class="count">2</span>
      <strong>Cross-File Consistency</strong> &mdash; The German and English editions
      have identical structure: same number of chapters, headings, code blocks, and tips,
      both globally and per-chapter.
    </div>

    <h2>Running the Tests</h2>

    <p>
      The tests run in a Podman container with the official Playwright image &mdash;
      no local browser installation needed:
    </p>

    <pre><code>cd layout_checks
npm test</code></pre>

    <p>
      That's it. Podman pulls the Playwright image (once), mounts the project directory,
      and runs all 170 tests in headless Chromium. Takes about 6 seconds.
    </p>

    <h2>What the Canary Tests Catch</h2>

    <p>
      The per-chapter canary tests are the most interesting part. When DOM nesting breaks
      (e.g., a <code>&lt;/div&gt;</code> closes a container too early), the damage propagates
      forward. Elements after the break point lose their parent context, which means CSS
      rules that rely on that context stop applying. By checking the <em>last</em> styled
      element in every chapter, we catch nesting damage anywhere in the file &mdash; even
      if it starts in chapter 2 and only becomes visible in chapter 5.
    </p>

    <div class="highlight">
      <strong>The key insight:</strong> In a single-file book with deeply nested HTML,
      DOM integrity tests are more valuable than HTML validation. The browser will happily
      &ldquo;fix&rdquo; broken nesting by reparenting nodes &mdash; technically valid HTML
      that looks completely wrong. Only a test that checks actual computed styles in a
      real browser can catch this.
    </div>

    <h2>AI Writing Its Own Tests</h2>

    <p>
      There's something fitting about this: the same AI that built the book, translated it,
      and added a new chapter also designed the test suite to protect its own work.
      Claude analyzed the DOM structure, identified the CSS values that matter,
      figured out which elements break first during nesting corruption, and wrote
      170 tests that run in a container with zero manual setup.
    </p>

    <p>
      The next time content gets added or modified, these tests will be the first
      line of defense. No more silent styling breakage hiding below the fold.
    </p>

    <div class="book-links">
      <a href="../book.html">
        <span class="arrow">&rarr;</span> Deutsche Ausgabe
      </a>
      <a href="../book_en.html">
        <span class="arrow">&rarr;</span> English Edition
      </a>
    </div>

    <p style="margin-bottom:0; color:#666; font-size:0.9rem;">
      <em>Original book by Gerhard Petracek. AI-assisted conversion, translation, testing,
      and this blog post by Claude (AI built by Anthropic). No manual edits were made after generation.</em>
    </p>
  </article>

  <nav class="post-nav">
    <a href="03-before-and-after.html" class="prev">&larr; From LaTeX to Modern Web</a>
    <a href="05-migration-to-quarkus.html" class="next">Migration to Quarkus &rarr;</a>
  </nav>

  <footer>
    <a href="index.html">&larr; All Blog Posts</a>
    <br>
    [CDI@Work]:AI &middot; An AI Journey &middot; 2026
  </footer>

</body>
</html>
